% only displays equation numbers if they are referenced
\mathtoolsset{showonlyrefs,showmanualtags}

\DeclareEmphSequence{\scshape}

% BEGIN custom geometry ************************************
%\setlength{\abovedisplayskip}{0.1em}
%\setlength{\belowdisplayskip}{0.2em}
\setlength{\abovedisplayskip}{0em}
\setlength{\belowdisplayskip}{0em}
\setlength{\abovedisplayshortskip}{0pt}
\setlength{\belowdisplayshortskip}{0pt}
\setlength{\jot}{0pt}

\titlespacing{\chapter}{0pt}{0em}{0.4em}
\titlespacing{\section}{0pt}{1.3em}{0.4em} %15pt, 3pt
\titlespacing{\subsection}{0pt}{1em}{0.4em} %15pt, 3pt
%\titlespacing{\subsubsection}{0pt}{6pt}{3pt}
%\titlespacing*{\chapter}{0pt}{-19pt}{0pt}

%For item, enumerate, description, lists
\setitemize{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
\setenumerate{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
\setdescription{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}
\setlist{noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt}

% END custom geometry **************************************

% new mdframed style that places the edges at the corners (.675em):
\mdfdefinestyle{proof-style}{
  skipabove         = 0.2em,% .5\baselineskip ,
  skipbelow         = 0,%.5\baselineskip ,
  leftmargin        = 0.4em ,
  rightmargin       = 0.4em ,
  innermargin       = 0pt ,
  innertopmargin    = 0.4em, %0.6 %.675em ,
  innerleftmargin   = 0.4em, %.675em ,
  innerrightmargin  = 0.4em,
  innerbottommargin = 0.2em, %.675em +3pt,
  hidealllines      = true,
  singleextra       = {
    \draw [thick] (O) -- ++(0,1em) (O) -- ++(1em,0) ;
    \draw [thick] (P-|O) -- ++(0,-1em) (P-|O) -- ++(1em,0) ;
  },
  firstextra        = {
    \draw [thick] (P-|O) -- ++(0,-1em) (P-|O) -- ++(1em,0) ;
  },
  secondextra       = {
    \draw [thick] (O) -- ++(0,1em) (O) -- ++(1em,0) ;
  },
}

\surroundwithmdframed[style=proof-style]{prf}
\surroundwithmdframed[style=proof-style]{proof}
\newtheorem*{prf}{Proof}

% custom QED Symbol
%\newcommand*\closedbox{%
%    \leavevmode\hbox to.77778em{\rule{.675em}{.675em}}}
%\let\qedsymbol\closedbox

%\renewcommand{\qedsymbol}{\rule{0.7em}{0.7em}}

\renewenvironment{prf}{{\textbf{\scshape \slshape Proof:}}}{\hfill $\qedsymbol$}
\renewenvironment{proof}{{\textbf{\scshape \slshape Proof:}}}{\hfill $\qedsymbol$}

% put the new mdframed style around the 'proof' and 'xmpl0 environment:
%\surroundwithmdframed[style=proof]{xmpl}

% BEGIN custom therem and proof environments ***************
\newtheoremstyle{mytheoremstyle} % name
{0.4em}                       % Space above {\topsep}
{.2em}                        % Space below
{}                            % Body font
{0em}                         % Indent amount
{}                            % Theorem head font {\ttfamily\fontseries{b}\selectfont}
{\textbf{:\,}}       % Punctuation after theorem head
{.2em}                        % Space after theorem head
{{\textbf{\scshape{\thmname{#1}\thmnumber{ #2}}}{\normalfont \thmnote{ ({\itshape#3})}}}}
                              % Theorem head spec (can be left empty, meaning ‘normal’)

% Define 'thm', 'thm-non', 'mydef', 'mydef-non', 'example', 'example-non'
% environments

\theoremstyle{mytheoremstyle}
\newtheorem{thm}{Thm}[chapter]
\newtheorem*{thm-non}{Thm}

%\theoremstyle{mytheoremstyle}
\newtheorem{mydef}[thm]{Def}
\newtheorem*{mydef-non}{Def}

%\theoremstyle{mytheoremstyle}
\newtheorem{example}[thm]{Example}
\newtheorem*{example-non}{Example}

\newtheorem{xrcs}{Exercise}
\newtheorem*{xrcs-non}{Exercise}

%\newtheoremstyle{indented-prf}
%{.2em}        % space before
%{0em}         % space after
%{
% \setlength{\leftskip}{\mathindent}
% \setlength{\parindent}{0pt}
% \addtolength{\linewidth}{-\mathindent-3em}
% \setlist[enumerate]{align=parleft,left=\mathindent..\mathindent+\mathindent-30pt}
% \setlist[description]{leftmargin=\mathindent,labelindent=\mathindent-6pt-27pt}
% \addtolength{\mathindent}{\mathindent}
%}
%{0em}         % indent
%{\bfseries}   % header font
%{\textbf{:}}  % punctuation
%{.3em}        % after theorem header
%{{\textbf{\scshape{\thmname{#1}\thmnumber{ #2}}}{\normalfont \thmnote{ (#3)}}}}

% define 'prf'-environment
%\theoremstyle{indented-prf}
%\newtheorem*{prf}{Proof}

%\def\endprf{
%  {\setlength{\leftskip}{\mathindent}\setlength{\rightskip}{3em}\setlength{\parindent}{0pt}\addtolength{\linewidth}{-\mathindent-3em}\setlist[enumerate]{align=parleft,left=\mathindent..\mathindent+\mathindent-30pt}\setlist[description]{leftmargin=\mathindent,labelindent=\mathindent-6pt-27pt} \addtolength{\mathindent}{\mathindent} \hfill$\blacksquare$}
%}

%\renewenvironment{proof}
%{{\textbf{Proof:}}}
%{\hfill $\Box$}
% END custom proof and thereom environments ****************


% BEGIN custom commands ************************************
%\DeclarePairedDelimiter\norm{\lVert}{\rVert}
%\DeclarePairedDelimiter\innerproduct{\langle}{\rangle}

% we need some space around dots
\newcommand\ddd{{\, \ldots \,\,}}

% such that, s. t.
\newcommand\st{{such that }}

% quotes
\newcommand\qt[1]{\textit{``#1''}}

\newcommand{\ip}[2]{\left \langle #1, #2 \right \rangle}
\newcommand{\norm}[1]{\left \lVert #1 \right \rVert}
\newcommand{\gt}{>}
\newcommand{\lt}{<}

% May be obsolete since you can use '$' inside equation environment
\newcommand\mytext[1]{\;\;\, \text{#1}\;\;}
\newcommand\myand{\;\;\, \text{and}\;\;}
\newcommand\myor{\;\;\, \text{or}\;\;}
\newcommand\where{\;\;\, \text{where}\;\;}
\newcommand\whereEach{\;\;\, \text{where each}\;\;}
\newcommand\dx{\, dx}
\newcommand\dy{\, dy}
\newcommand\dz{\, dz}
\newcommand\du{\, du}

% BFEMPH
\newcommand{\bfemph}[1]{{\textbf{\scshape #1}}}

% natural numbers, integers, real numbers, complex numbers:
\newcommand{\nat}{\mathbb{N}}
\newcommand{\integer}{\mathbb{N}}
\newcommand{\real}{\mathbb{R}}
\newcommand{\compl}{\mathbb{C}}
\newcommand{\myF}{\mathbb{F}}

% polynomial symbol:
\newcommand{\polyn}{\mathcal{P}}

% degree operator:
\def\degree{{\operatorname{deg} \,}}

% Matrix symbol M:
\newcommand{\mmatrix}{\mathcal{M}}

% use \span{..} for span(..)
\newcommand{\myspan}[1]{\operatorname{span} (#1)}

%Fast way to write v_1 ... v_n
\newcommand{\oneTillN}[1]{#1_1, \dots, #1_n}
\newcommand{\onetilln}[1]{#1_1, \dots, #1_n}

%Fast way to write v_1 ... v_m
\newcommand{\oneTillM}[1]{#1_1, \dots, #1_m}
\newcommand{\onetillm}[1]{#1_1, \dots, #1_m}
\newcommand{\setOneTillM}{\{ 1, \ldots, m \}}
\newcommand{\setonetillm}{\{ 1, \ldots, m \}}

% fast way to write v_1 ... v_{#2}
% usage \onetill{v}{k-1} yields v_1 \dots v_{k-1}
\newcommand{\oneTill}[2]{#1_1, \dots, #1_{#2}}
\newcommand{\onetill}[2]{#1_1, \dots, #1_{#2}}

\newcommand{\kInOneTillM}{k \in \{1, \dots, m \}} % k e {1...m}
\newcommand{\kinonetillm}{k \in \{1, \dots, m \}} % k e {1...m}
\newcommand{\kInOneTillN}{k \in \{1, \dots, n \}} % k e {1...n}
\newcommand{\kinonetilln}{k \in \{1, \dots, n \}} % k e {1...n}
\newcommand{\kInOneTillP}{k \in \{1, \dots, p \}} % k e {1...p}
\newcommand{\kinonetillp}{k \in \{1, \dots, p \}} % k e {1...p}

% abbreviation for finite-dimensional vector space
\newcommand{\findimvecpac}{finite\-/dimensional vector space }
\newcommand{\findimvs}{finite\-/dimensional vector space }
\newcommand{\fdvs}{finite\-/dimensional vector space }

% abbreviation for linearly independent
\newcommand{\lid}{linearly independent}

% abbreviation for linearly independent
\newcommand{\ld}{linearly dependent }

% abbreviation for linearly independent
\newcommand{\vs}{vector space }

% abbreviation for finite-dimensional
\newcommand{\fd}{finite\-/dimensional }

% abbreviation for linear map
\newcommand{\lm}{{linear map }}

% abbreaviation for L(V,W)
\newcommand{\lvw}{{\mathcal{L}(V,W)}}

% use \linmap for L or \lin{arg1}{arg2} for L(arg1, arg2)
\newcommand{\linmap}{\mathcal{L}}
\newcommand{\lin}[2]{{\mathcal{L}(#1, #2)}}

% null and range
\newcommand{\mynull}{\operatorname{null}}
\newcommand{\myrange}{\operatorname{range}}

% dimension
\newcommand{\mydim}{\operatorname{dim}}

% even and odd
\newcommand{\even}{\operatorname{even}}
\newcommand{\odd}{\operatorname{odd}}

% dual space
\newcommand{\dual}[1]{#1\mathlarger{'}}

% legacy

% \newcommand{\basis}[2]{\overbrace{ \myspan{#1_1, \dots #1_{#2}}}^{\text{linearly independent}} }}
\def\myimpl{{\{black}{\implies}}

% octave or matlab
\newcommand{\octave}[1]{

\begin{center}
  \begin{minipage}{\linewidth}

    \addtolength{\linewidth}{-7em}
    \lstinputlisting[
    aboveskip=0.7em,
    frame=single,
    numbers=left,
    style=Matlab-bw,
    basicstyle=\scriptsize\ttfamily]{octave/#1}
    \addtolength{\linewidth}{+7em}

  \end{minipage}
\end{center}

}

% real part, imagenary part
\newcommand{\realpart}{\operatorname{Re}}
\newcommand{\impart}{\operatorname{Im}}

% dashed box
\newtcbox{\dashedbox}[1][]{
  math upper,
baseline=0.4\baselineskip,
equal height group=dashedbox,
nobeforeafter,
colback=white,
boxrule=0pt,
enhanced jigsaw,
boxsep=0pt,
top=2pt,
bottom=2pt,
left=2pt,
right=2pt,
borderline horizontal={0.5pt}{0pt}{dashed},
borderline vertical={0.5pt}{0pt}{dashed},
drop lifted shadow,
#1
}

% END custom comands ***************************************

% BEGIN custom chapter format ******************************
\renewcommand*{\thechapter}{\arabic{chapter}}
\renewcommand*{\thesection}{\arabic{chapter}\Alph{section}}
\renewcommand*{\thesubsection}{\arabic{chapter}\Alph{section}\arabic{subsection}}

\titleformat{\chapter}[block]
{\bfseries\scshape}{\relscale{1.1}#1 {\footnotesize (Chapter \thechapter)}}{0.5em}{\large}
\titleformat{\section}{\bfseries\scshape}{}{0em}{{\relscale{1.1}#1} {\footnotesize(Section  \thesection)}} %Large
\titleformat{\subsection}{\relscale{1.1}\bfseries\scshape}{}{0em}{#1 {\footnotesize (Sub-subsection \thesubsection)}} %large
% END custom chapter format ********************************